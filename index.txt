<!-- ===== AUTH MODALS (paste into your HTML, near end of <body>) ===== -->
<!-- Auth buttons (put in header/nav) -->
<div style="position:fixed; right:20px; top:20px; z-index:1000;">
  <button id="openLoginBtn" style="margin-right:8px; padding:8px 12px;">Login</button>
  <button id="openSignupBtn" style="padding:8px 12px;">Sign Up</button>
</div>

<!-- Overlay modal (single modal toggles between login/signup) -->
<div id="authOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:2000; align-items:center; justify-content:center;">
  <div id="authModal" style="width:95%; max-width:420px; background:#fff; padding:22px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.2);">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
      <h3 id="authTitle">Login</h3>
      <button id="closeAuth" style="background:none; border:none; font-size:18px;">âœ•</button>
    </div>

    <div id="error" style="color:#b00020; margin-bottom:8px; display:none;"></div>

    <!-- Login Form -->
    <form id="loginForm" style="display:block;">
      <input id="loginEmail" type="email" placeholder="Email" required style="width:100%; padding:10px; margin-bottom:8px; border-radius:6px; border:1px solid #ddd;">
      <input id="loginPassword" type="password" placeholder="Password" required style="width:100%; padding:10px; margin-bottom:12px; border-radius:6px; border:1px solid #ddd;">
      <button type="submit" style="width:100%; padding:10px; border-radius:8px; background:#1877f2; color:#fff; border:none;">Login</button>
      <p style="text-align:center; margin-top:10px;">Don't have an account? <a href="#" id="showSignup">Sign up</a></p>
    </form>

    <!-- Signup Form -->
    <form id="signupForm" style="display:none;">
      <input id="signupName" type="text" placeholder="Full Name" required style="width:100%; padding:10px; margin-bottom:8px; border-radius:6px; border:1px solid #ddd;">
      <input id="signupEmail" type="email" placeholder="Email" required style="width:100%; padding:10px; margin-bottom:8px; border-radius:6px; border:1px solid #ddd;">
      <input id="signupPassword" type="password" placeholder="Password (min 8 chars)" required minlength="8" style="width:100%; padding:10px; margin-bottom:12px; border-radius:6px; border:1px solid #ddd;">
      <button type="submit" style="width:100%; padding:10px; border-radius:8px; background:#1db954; color:#fff; border:none;">Create Account</button>
      <p style="text-align:center; margin-top:10px;">Already have an account? <a href="#" id="showLogin">Login</a></p>
    </form>
  </div>
</div>

<script>
/* ====== CONFIG: set this to your backend base URL ====== */
const API_BASE = "http://localhost:4000"; // change to your deployed backend URL in production

/* ====== modal controls ====== */
const overlay = document.getElementById('authOverlay');
const openLoginBtn = document.getElementById('openLoginBtn');
const openSignupBtn = document.getElementById('openSignupBtn');
const closeAuth = document.getElementById('closeAuth');
const loginForm = document.getElementById('loginForm');
const signupForm = document.getElementById('signupForm');
const authTitle = document.getElementById('authTitle');
const errBox = document.getElementById('error');

openLoginBtn.addEventListener('click', () => { showModal('login'); });
openSignupBtn.addEventListener('click', () => { showModal('signup'); });
closeAuth.addEventListener('click', closeModal);
document.getElementById('showSignup').addEventListener('click', (e) => { e.preventDefault(); toggleForms('signup'); });
document.getElementById('showLogin').addEventListener('click', (e) => { e.preventDefault(); toggleForms('login'); });

function showModal(mode='login'){ overlay.style.display='flex'; toggleForms(mode); errBox.style.display='none'; }
function closeModal(){ overlay.style.display='none'; }
function toggleForms(mode){
  if(mode==='login'){ loginForm.style.display='block'; signupForm.style.display='none'; authTitle.innerText='Login'; }
  else { loginForm.style.display='none'; signupForm.style.display='block'; authTitle.innerText='Sign Up'; }
}

/* ====== helper ====== */
function showError(msg){
  errBox.innerText = msg;
  errBox.style.display = 'block';
}

/* ====== Signup submit ====== */
signupForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const name = document.getElementById('signupName').value.trim();
  const email = document.getElementById('signupEmail').value.trim();
  const password = document.getElementById('signupPassword').value;

  try {
    const res = await fetch(API_BASE + '/api/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, email, password })
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data.message || 'Signup failed');
    // success: token returned
    localStorage.setItem('token', data.token);
    alert('Account created! You are now logged in.');
    closeModal();
  } catch(err) {
    showError(err.message);
  }
});

/* ====== Login submit ====== */
loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  try {
    const res = await fetch(API_BASE + '/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data.message || 'Login failed');
    localStorage.setItem('token', data.token);
    alert('Logged in successfully!');
    closeModal();
  } catch(err) {
    showError(err.message);
  }
});

/* Optional: function to get profile (auth test) */
async function fetchProfile(){
  const token = localStorage.getItem('token');
  if(!token) return null;
  const res = await fetch(API_BASE + '/api/profile', {
    headers: { Authorization: 'Bearer ' + token }
  });
  if(!res.ok) return null;
  return await res.json();
}
</script>
<!-- ===== END AUTH MODALS ===== -->
